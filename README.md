# AI 聊天助手工具

这是一个用于 `aichat` 命令行工具的辅助应用，增强了历史记录管理和会话连续性功能。

## 功能特点

- 记录所有聊天历史到 SQLite 数据库
- 支持不同角色模式（默认, 代码执行, 自定义角色）
- 会话管理功能，可以组合多条历史消息
- 灵活的历史记录查询和重用
- 代码执行模式下支持与 aichat 的完整交互

## 安装

### 编译

- pyinstaller --onefile --distpath . --clean ai.py

### 依赖

- Python 3.6+
- aichat 命令行工具（已安装并可访问）

### 安装步骤

1. 克隆或下载此仓库
2. 安装依赖：
   ```
   pip install -r requirements.txt
   ```
3. 确保 `ai.py` 文件具有执行权限：
   ```
   chmod +x ai.py   # 在Linux/Mac系统上
   ```
4. 可选：添加到系统 PATH 或创建别名以便全局访问

## 使用方法

### 基本用法

```bash
# 基本问答
python ai.py 讲一个笑话

# 代码执行模式
python ai.py -e 列出当前目录文件
# 在代码执行模式下，程序会等待您与aichat交互，选择执行、修改等选项

### 代码执行模式交互

在代码执行模式下 (`-e` 参数)，工具会：
1. 运行 `aichat -e` 命令
2. 等待您在终端与 aichat 交互，通常会出现类似提示：
   ```
   命令建议: Get-ChildItem
   ? execute | revise | describe | copy | quit: (e)
   ```
3. 您可以选择相应选项（如按 e 执行命令）
4. 命令执行完成后，ai 工具会继续处理并保存记录

### 自定义角色

```bash
# 使用特定角色
python ai.py -r 教授 解释量子力学
```

### 会话管理

```bash
# 开始新会话（支持简写 -m s）
python ai.py -m start 你是谁
# 或
python ai.py -m s 你是谁

# 继续当前会话（直接使用-m不带参数，会关联当前活跃会话的所有历史记录）
python ai.py -m 我该如何使用你的功能

# 查看最近的聊天历史（倒序显示，最新的消息显示为序号1）
python ai.py -m list
# 或使用简写形式
python ai.py -m l

# 携带最近的3条聊天记录
python ai.py -m 3 基于我们的对话，接下来我该做什么

# 携带指定范围的聊天记录（从倒数第2条到倒数第4条）
python ai.py -m 2-4 分析这几条消息的共同点

# 携带选定的几条聊天记录
python ai.py -m 1,3,5 基于这些消息，给我一个总结
```

### 会话流程示例

```bash
# 1. 开始一个新会话
python ai.py -m start 你是谁

# 2. 继续会话 - 这会自动包含前一条消息的上下文
python ai.py -m 我能问你些什么问题？

# 3. 继续同一会话 - 所有从-m start开始的历史都会被包含
python ai.py -m 给我讲个故事
```

## 数据存储

所有聊天记录保存在 SQLite 数据库中，位于ai.py同目录下的 `ai_chat_history.db` 文件中。

## 自定义配置

可以修改 `ai.py` 中的以下设置：
- `DB_PATH`：数据库文件的位置
- 默认显示的聊天记录数量

## 故障排除

如果遇到问题：
1. 确认 `aichat` 命令可以独立正常工作
2. 检查 Python 版本是否兼容
3. 确保数据库有写入权限
4. 如果-m不带参数报错，请确保先运行 `-m start` 开始一个会话
5. 在代码执行模式下，如果没有看到交互选项，请检查终端环境是否支持交互

## 许可证

MIT 